<!DOCTYPE html>
<html lang="ja">
<head>

<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />

<link rel="shortcut icon" href="favicon.ico" />
<link rel="apple-touch-icon" href="apple-touch-icon.png" />

<link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/3.8.1/build/cssreset/cssreset-min.css">

<link href="css/jquery-ui.css?v=1" rel="stylesheet">
<link href="css/bootstrap.css?v=1" rel="stylesheet">
<link href="css/font-awesome.css?v=1" rel="stylesheet">
<link href="css/common.css?v=1" rel="stylesheet">

<style>
	#sortable {
		list-style-type: none;
		margin: 0;
		padding: 0;
		width: 295px;
	}

	#sortable li {
		padding: 0.4em;
		height: 13px;
		width: 275px;
		display: block;
		position: relative;
	}

	#sortable li span.ui-icon {
		float: left;
		margin-left: 3px;
	}

	#sortable li div.linkItem {
		float: left;
		width: 210px;
	}

	#sortable li div.separator {
		display: inline;
		float: left;
		width: 210px;
		height: 3px;
		margin: 5px 0px 5px 0;
		border-bottom: 1px dashed #DDDDDD;
	}

	#sortable li div.div-icon-del-edit {
		float: left;
		width: 40px;
	}

	blockquote p {
		font-size: 1em;
	}

	#freeMemoArea {
		height: 141px;
	}

	#freeMemo {
		width: 280px;
		height: 85px;
		display: block;
		margin: -5px auto 0px auto;
		font-size: 12px;
		color: #666666;
	}
</style>

<title>トップページ</title>

</head>

<body>

<div id="body">

<!-- ヘッダー -->
<div id="header" class="ballsh">
	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container">
				<a class="brand" href="/StudyMaterials-Ver_Mock">StudyMaterials [Version : Mock]</a>
				<div class="nav-collapse collapse">
					<ul class="nav">
						<li class="active"><a href="top.html"><i class="icon-home"></i>トップページ</a></li>
						<li><a href="message-board.html"><i class="icon-comment"></i>掲示板</a></li>
						<li><a href="todo.html"><i class="icon-list-alt"></i>TODO</a></li>
					</ul>
					<ul class="nav" style="float: right;">
						<li class="dropdown">
							<a class="dropdown-toggle" data-toggle="dropdown" href="#"><img src="yamaguchi-icon_normal.png" class="userIcon">you_name_is_yu<b class="caret"></b></a>
							<ul class="dropdown-menu">
								<li><a href="user_settings.html">設定変更</a></li>
								<li class="divider"></li>
								<li><a href="login.html">ログアウト</a></li>
							</ul>
						</li>
					</ul>
				</div><!--/.nav-collapse collapse -->
			</div>
		</div>
	</div><!-- /.navbar navbar-inverse navbar-fixed-top -->
</div>

<!-- パンくずリスト -->
<div class="container ballsh">
	<ul class="breadcrumb">
		<!-- <li><a href="#">Home</a> <span class="divider">/</span></li> -->
		<li class="active">トップページ</li>
	</ul>
</div>

<!-- コンテンツ -->
<div class="container">
	<div class="row">
		<!-- 新着表示のエリア -->
		<div class="span8 ballsh">
			<div class="block">
				<h3>新着情報</h3>
				<div style="max-height: 400px; overflow-y: auto;">
					<div class="messageBoardNews">
						<h5>
							<i class="icon-comment" style="margin: 0 10px 0 10px;"></i>
							掲示板
						</h5>
						<ul style="list-style: none;">
							<li>
								<blockquote>
									<p>
										<a href="#" class="textOverflowNowrap">掲示板のタイトル部分だよaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</a>
										<small class="textOverflowNowrap">ここにメッセージ部分を若干表示するょaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</small>
									</p>
								</blockquote>
							</li>
							<li>
								<blockquote>
									<p>
										<a href="#" class="textOverflowNowrap">掲示板のタイトル部分だよ２</a>
										<small class="textOverflowNowrap">ここにメッセージ部分を若干表示するょ２...</small>
									</p>
								</blockquote>
							</li>
						</ul>
					</div>

					<div class="todoNews">
						<h5>
							<i class="icon-list-alt" style="margin: 0 10px 0 10px;"></i>
							TODO
						</h5>
						<ul style="list-style: none;">
							<li>
								<blockquote>
									<p>
										<a href="#" class="textOverflowNowrap">TODO１</a>
										<small class="textOverflowNowrap">TODO１</small>
									</p>
								</blockquote>
							</li>
							<li>
								<blockquote>
									<p>
										<a href="#" class="textOverflowNowrap">TODO２</a>
										<small class="textOverflowNowrap">TODO２</small>
									</p>
								</blockquote>
							</li>
						</ul>
					</div>
				</div>
			</div><!-- /.block -->
		</div>

		<!-- 画面右側のエリア -->
		<div class="span4">
			<!-- リンク集（画面右側に表示） -->
			<div class="block ballsh" id="collectionOfLinks">
				<h3>
					<img src="img/icon-link.png" style="width: 16px; height: 16px;">リンク集
					<span id="span-link-edit" style="float: right; font-size: 10px; margin: 0 5px 0 0;">
						<a id="link-edit" href="#">編集</a>
					</span>
					<span id="span-link-commit-cancel" style="float: right; font-size: 10px; margin: 0 5px 0 0; display: none;">
						<a id="link-commit" href="#">完了</a>
						<a id="link-cancel" href="#">キャンセル</a>
					</span>
				</h3>
				<div id="link-operation-btns" style="margin: 0 0 0 10px; font-size: 10px; display: none;">
					<a id="addLink" href="#"><img src="img/icon-add-mark.png" style="width: 15px; height: 15px;">リンクの追加</a>
					<a id="addSeparate" href="#"><img src="img/icon-add-mark.png" style="width: 15px; height: 15px;">区切りの追加</a>
				</div>
				<div style="max-height: 150px; overflow: auto; overflow-x: hidden; overflow-y: auto;">
					<ul id="sortable" class="ui-sortable">
						<li>
							<div class="linkItem textOverflowNowrap">
								<a href="http://www.sansou.co.jp" target="_blank">Item 1aiueoaiueoaiueo</a>
							</div>
						</li>
						<li>
							<div class="linkItem textOverflowNowrap">
								<a href="http://www.sansou.co.jp" target="_blank">Item 2</a>
							</div>
						</li>
						<li><div class="separator"></div></li>
						<li>
							<div class="linkItem textOverflowNowrap">
								<a href="http://www.sansou.co.jp" target="_blank">Item 3</a>
							</div>
						</li>
						<li>
							<div class="linkItem textOverflowNowrap">
								<a href="http://www.sansou.co.jp" target="_blank">Item 4</a>
							</div>
						</li>
					</ul>
				</div>
			</div><!-- /#collectionOfLinks-->

			<!-- メモ欄（画面右側に表示） -->
			<div class="block ballsh" id="freeMemoArea">
				<h3>
					メモ欄
				</h3>
				<div>
					<textarea id="freeMemo" name="freeMemo" placeholder="自動で保存されます"></textarea>
					<div id="saveMessage" class="muted" style="display: none; margin-left: 10px;"><small>保存しました...</small></div>
				</div>
			</div><!-- /#freeMemoArea-->
		</div>
	</div>
</div><!-- /.container -->

<!-- フッター -->
<div id="footer" class="ballsh">
	<footer class="muted"> Copyright&copy; 2013 YU YAMAGUCHI <footer>
</div>

<!-- リンク集登録／編集フォーム -->
<div id="editLinkArea" class="modal hide fade ballsh">
	<div class="modal-header">
		<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		<h3 id="myModalLabel">リンクの登録</h3>
	</div>
	<div class="modal-body">
		<form id="frm-link-input" class="form-horizontal">
			<div class="control-group">
				<label class="control-label" for="linkTitle" style="width: 120px;">タイトル</label>
				<div class="controls" style="margin-left: 140px;">
					<input type="text" class="span4" id="linkTitle" name="linkTitle" placeholder="タイトル" maxlength="30">
				</div>
			</div>
			<div class="control-group">
				<label class="control-label" for="linkUrl" style="width: 120px;">URL</label>
				<div class="controls" style="margin-left: 140px;">
					<input type="text" class="span4" id="linkUrl" name="linkUrl" placeholder="ex) http://www.sample.co.jp" maxlength="2048">
				</div>
			</div>
		</form>
	</div>
	<div class="modal-footer">
		<button type="button" id="btnReg" class="btn btn-primary">登録</button>
		<button type="button" id="btnEdit" class="btn btn-primary">更新</button>
		<button type="button" id="btnCancel" class="btn">キャンセル</button>
	</div>
</div>

<!-- リンク集一覧のセパレータテンプレート（非表示） -->
<div id="linkSeparatorTemplate" style="display: none;">
	<span class="ui-icon ui-icon-arrowthick-2-n-s" style="cursor: move;"></span>
	<div class="separator"></div>
	<div class="div-icon-del-edit">
		<a href="#" class="link-icon-edit visibleHidden" data-href="#">
			<i class="icon-edit" title="編集"></i>
		</a>
		<a href="#" class="link-icon-trash" data-href="#">
			<i class="icon-trash" title="削除"></i>
		</a>
	</div>
</div>

<!-- リンク集一覧のリンクテンプレート（非表示） -->
<div id="linkTemplate" style="display: none;">
	<span class="ui-icon ui-icon-arrowthick-2-n-s" style="cursor: move;"></span>
	<div class="linkItem textOverflowNowrap">
		<a href="#" target="_blank" data-href="#">ココにリンク</a>
	</div>
	<div class="div-icon-del-edit">
		<a href="#" class="link-icon-edit" data-href="#">
			<i class="icon-edit" title="編集"></i>
		</a>
		<a href="#" class="link-icon-trash" data-href="#">
			<i class="icon-trash" title="削除"></i>
		</a>
	</div>
</div>

<!-- javascript -->
<script src="js/jquery.js?v=1"></script>
<script src="js/jquery-ui.js?v=2"></script>
<script src="js/jquery.validate.js?v=1"></script>
<script src="js/jquery.validate.original.js?v=1"></script>
<script src="js/bootstrap.js?v=1"></script>
<script src="js/common.js?v=1"></script>

<script>
	$(function(){
		$("#sortable").sortable({
			cursor: "move"
		});
		$("#sortable").sortable("disable");

		// リンク集の編集前の状態を保持するオブジェクト
		var saveCollectionOfLinks;

		// リンク編集対象となる行データ
		var $linkEditTarget = null;

		/**
		 * リンクの追加リンク押下イベント
		 */
		$("#addLink").on("click", function(){
			$("#btnEdit").hide();
			$("#btnReg").show();
			$("#editLinkArea").modal("show");
		});

		/**
		 * リンク集の編集リンク押下処理
		 */
		$("#link-edit").on("click", function(){
			saveCollectionOfLinks = $("#sortable").html();
			$("#span-link-edit").hide(100);
			$("#span-link-commit-cancel").show(100);
			$("#sortable").sortable("enable");
			$("<span class='ui-icon ui-icon-arrowthick-2-n-s' style='cursor: move;'></span>").prependTo("#sortable li");
			$("<div class='div-icon-del-edit'><a href='#' class='link-icon-edit'><i class='icon-edit' title='編集'></i></a> <a href='#' class='link-icon-trash'><i class='icon-trash' title='削除'></i></a></div>").appendTo("#sortable li");
			$("#sortable li div.separator + div.div-icon-del-edit .link-icon-edit").addClass("visibleHidden");
			$("#link-operation-btns").slideDown(400);
			$("#sortable li a").each(function(){
				$(this).attr("data-href", $(this).attr("href"));
				$(this).attr("href", "#");
			});
		});

		/**
		 * リンク集の完了リンク押下処理
		 */
		$("#link-commit").on("click", function(){
			$("#span-link-edit").show(100);
			$("#span-link-commit-cancel").hide(100);
			$("#sortable").sortable("disable");
			$("#sortable li > span").remove();
			$("#sortable .div-icon-del-edit").remove();
			$("#link-operation-btns").slideUp(400);
			$("#sortable li a").each(function(){
				$(this).attr("href", $(this).attr("data-href"));
				$(this).removeAttr("data-href");
			});
		});

		/**
		 * リンク集のキャンセルリンク押下処理
		 */
		$("#link-cancel").on("click", function(){
			$("#span-link-edit").show(100);
			$("#span-link-commit-cancel").hide(100);
			$("#sortable").sortable("disable");
			$("#sortable li > span").remove();
			$("#link-operation-btns").slideUp(400);

			$("#sortable").html(saveCollectionOfLinks);
			saveCollectionOfLinks = null;
		});

		/**
		 * リンク集の『区切りの追加』押下処理
		 */
		$("#addSeparate").on("click", function(){
			// セパレーターのテンプレートをクローンして追加処理を行う
			$("<li style='display: none;'></li>").wrapInner($("#linkSeparatorTemplate").children().clone(true)).appendTo("#sortable");
			$("#sortable li:last").slideDown(400);
		});

		/**
		 * リンク集の登録／編集画面右上にある×ボタン押下イベント
		 */
		$("button.close").on("click", function(){
			resetForm4Bootstrap($("#editLinkArea form")[0], validator);
		});

		/**
		 * リンク集の編集処理（鉛筆アイコン押下時）
		 * ** jQuery1.7より「live()」は非推奨となり、1.9から仕様不可となったようで、
		 * ** live()の部分をon()に書き換えています。
		 * ** ただし、jQuery1.9だとtwitter bootstrapも正常動作しないため、
		 * ** このサンプルで使用しているjQueryは1.8.3です。
		 */
		$(document).on("click", ".link-icon-edit", function(event){
			// 登録ボタン／更新ボタンの表示切替え
			$("#btnEdit").show();
			$("#btnReg").hide();

			// 編集対象となるリンクの行（LI）をセット
			$linkEditTarget = $(this).closest("li");

			// フォームに値をセット
			$("#linkTitle").val($linkEditTarget.find("div.linkItem a").text());
			$("#linkUrl").val($linkEditTarget.find("div.linkItem a").attr("data-href"));

			// フォームを表示
			$("#editLinkArea").modal("show");
		});

		/**
		 * リンク集の削除処理（ゴミ箱アイコン押下時）
		 */
		$(document).on("click", ".link-icon-trash", function(event){
			var $target = $(this).closest("li");
			$target.slideUp(
				250
				, function(){
					$target.remove();
				});
		});

		/**
		 * リンクの登録画面 登録ボタン押下時のイベント
		 */
		$("#btnReg").on("click", function(){
			if ($("#editLinkArea form").valid()) {
				// リンクのテンプレートをセット
				var $template = $("<li style='display: none;'></li>").wrapInner($("#linkTemplate").children().clone(true));

				// リンクの値をセット
				$template.find("div.linkItem a").attr("data-href", $("#linkUrl").val()).text($("#linkTitle").val());

				// 一覧に追加
				$template.appendTo("#sortable");

				// アニメーションで追加処理を明示
				$("#editLinkArea").modal("hide");
				$("#sortable li:last").slideDown(400);

				resetForm4Bootstrap($("#editLinkArea form")[0], validator);
			}
		});

		/**
		 * リンク編集画面の更新ボタン押下時のイベント
		 */
		$("#btnEdit").on("click", function(){
			if ($("#editLinkArea form").valid()) {
				// 更新情報を反映
				var $target = $linkEditTarget;
				var $form = $("#editLinkArea form");

				$target.find("div.linkItem a").text($form.find("#linkTitle").val());
				$target.find("div.linkItem a").attr("data-href", $form.find("#linkUrl").val());

				// リンク登録・更新フォームの非表示・リセット
				$("#editLinkArea").modal("hide");
				resetForm4Bootstrap($("#editLinkArea form")[0], validator);
			}
		});

		/**
		 * リンクの登録画面 キャンセルボタン押下時のイベント
		 */
		$("#editLinkArea #btnCancel").on("click", function(){
			$("#editLinkArea").modal("hide");
			resetForm4Bootstrap($("#editLinkArea form")[0], validator);
		});

		/**
		 * リンク登録画面表示中の黒い背景エリア押下時のイベント
		 */
		$(document).on("click", "div.modal-backdrop", function(){
			resetForm4Bootstrap($("#editLinkArea form")[0], validator);
		});

		/**
		 * リンク登録・編集画面のバリデーション
		 */
		var validator = $("#editLinkArea form").validate({
			rules: {
				linkTitle: {
					maxlength: 30
					, required: true
				}
				, linkUrl: {
					maxlength: 2048
					, url: true
					, required: true
				}
			}
			, highlight: function(element) {
				$(element).closest('.control-group').removeClass('success').addClass('error');
			}
			, success: function(element) {
				element.text('OK!').addClass('valid').closest('.control-group').removeClass('error').addClass('success');
			}
			, onfocusout: false
			, onclick: false
		});

		/** メモ欄の処理 **/

		/**
		 * HTML5のlocalStorageを使ったメモ欄の活用
		 */
		if (localStorage.getItem("freeMemo")){
			$("#freeMemo").val(localStorage.getItem("freeMemo"));
		}

		var timerId = null;

		var saveFreeMemo = function() {
			localStorage.setItem("freeMemo", $("#freeMemo").val());
			$("#saveMessage").slideDown(600, function(){
					$(this).slideUp(600);
				});
		};

		$("#freeMemo").on("keyup", function() {
			if (timerId) {
				clearTimeout(timerId);
				timerId = null;
			}
			timerId = setTimeout(function(){
					timerId = null;
					saveFreeMemo();
				}, 3000);
		});

		$("#freeMemo").on("blur", function() {
			if (timerId) {
				clearTimeout(timerId);
				timerId = null;
				saveFreeMemo();
			}
		});
	});
</script>

</div><!-- ./#body -->

</body>
</html>